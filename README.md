# Bili-Cortex

ğŸ¥ æ™ºèƒ½è§†é¢‘åˆ†æä¸çŸ¥è¯†æå–ç³»ç»Ÿ

æ”¯æŒ **Bilibili** å’Œ **YouTube** è§†é¢‘è‡ªåŠ¨è½¬æ¢ä¸ºé«˜è´¨é‡çš„ä¸­æ–‡è½¬å½•æ–‡æœ¬ï¼Œå¹¶æ„å»ºå¯æœç´¢çš„çŸ¥è¯†åº“ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢å’Œå†…å®¹åˆ†æã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **é«˜è´¨é‡è½¬å½•**: åŸºäº Whisper çš„ç²¾å‡†ä¸­æ–‡è¯­éŸ³è¯†åˆ«
- ğŸ§  **æ™ºèƒ½çŸ¥è¯†åº“**: è‡ªåŠ¨æ„å»ºå¯æœç´¢çš„å‘é‡åŒ–çŸ¥è¯†åº“
- ğŸ” **è¯­ä¹‰æœç´¢**: æ”¯æŒè‡ªç„¶è¯­è¨€æŸ¥è¯¢å’Œå†…å®¹æ£€ç´¢
- ğŸ“Š **æ‰¹é‡å¤„ç†**: æ”¯æŒå¤šè§†é¢‘å¹¶è¡Œå¤„ç†
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒç®€ä½“/ç¹ä½“ä¸­æ–‡è‡ªåŠ¨è½¬æ¢
- âš¡ **GPUåŠ é€Ÿ**: è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨GPUåŠ é€Ÿå¤„ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè®¾ç½®

```bash
# å…‹éš†é¡¹ç›®åï¼Œè¿è¡Œä¸€é”®è®¾ç½®è„šæœ¬
./setup.sh
```

### 2. åŸºç¡€è½¬å½•

```bash
# è½¬å½•å•ä¸ªBilibiliè§†é¢‘
./bili-cortex.sh https://www.bilibili.com/video/BV1234567890

# è½¬å½•å•ä¸ªYouTubeè§†é¢‘
./bili-cortex.sh https://www.youtube.com/watch?v=example123

# è½¬å½•YouTubeé¢‘é“ï¼ˆé»˜è®¤10ä¸ªè§†é¢‘ï¼‰
./bili-cortex.sh https://www.youtube.com/channel/UC1234567890

# é™åˆ¶é¢‘é“è§†é¢‘æ•°é‡
./bili-cortex.sh --channel-limit 3 https://www.youtube.com/channel/UC1234567890

# æ··åˆå¤„ç†ï¼ˆè§†é¢‘+é¢‘é“ï¼‰
./bili-cortex.sh bilibili_url youtube_channel_url

# ä»æ–‡ä»¶æ‰¹é‡è½¬å½•
./bili-cortex.sh --from-file urls.txt
```

### 3. çŸ¥è¯†åº“æœç´¢

```bash
# æœç´¢å·²å¤„ç†çš„å†…å®¹
./bili-cortex.sh --search "æœºå™¨å­¦ä¹ ç®—æ³•"

# æ¼”ç¤ºæœç´¢åŠŸèƒ½
./bili-cortex.sh --search-demo

# ä¸æ„å»ºçŸ¥è¯†åº“ï¼Œä»…è½¬å½•
./bili-cortex.sh --no-kb https://www.bilibili.com/video/BV1234567890
```

### 4. æ‰¹é‡å¤„ç†æ–‡ä»¶æ ¼å¼

åˆ›å»º `urls.txt` æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ª URLï¼ˆæ”¯æŒæ··åˆå¹³å°ï¼‰ï¼š
```
# Bilibili URLs
https://www.bilibili.com/video/BV1234567890
https://www.bilibili.com/video/BV1234567891
https://b23.tv/abc123

# YouTube å•è§†é¢‘ URLs
https://www.youtube.com/watch?v=example123
https://youtu.be/shortExample

# YouTube é¢‘é“ URLs (é»˜è®¤10ä¸ªè§†é¢‘)
https://www.youtube.com/channel/UC1234567890
https://www.youtube.com/@channel_name

# æ³¨é‡Šè¡Œä¼šè¢«å¿½ç•¥
```

## ğŸ“‹ å‘½ä»¤é€‰é¡¹

### åŸºç¡€é€‰é¡¹
| é€‰é¡¹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `--from-file, -f` | ä»æ–‡ä»¶è¯»å– URL åˆ—è¡¨ | `-f urls.txt` |
| `--channel-limit` | é¢‘é“è§†é¢‘æ•°é‡é™åˆ¶ | `--channel-limit 5` |
| `--no-save` | ä¸ä¿å­˜è½¬å½•æ–‡ä»¶ | `--no-save` |
| `--no-kb` | ä¸æ„å»ºå‘é‡çŸ¥è¯†åº“ | `--no-kb` |
| `--log-level` | è®¾ç½®æ—¥å¿—çº§åˆ« | `--log-level DEBUG` |
| `--info` | æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯ | `--info` |
| `--help, -h` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ | `--help` |

### çŸ¥è¯†åº“é€‰é¡¹
| é€‰é¡¹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `--search, -s` | æœç´¢çŸ¥è¯†åº“å†…å®¹ | `-s "æ·±åº¦å­¦ä¹ "` |
| `--search-demo` | æ¼”ç¤ºæœç´¢åŠŸèƒ½ | `--search-demo` |

## ğŸŒ è¯­è¨€è®¾ç½®

### æ”¯æŒçš„è¯­è¨€æ ¼å¼
- `zh-CN`: ç®€ä½“ä¸­æ–‡ï¼ˆè‡ªåŠ¨è½¬æ¢ä¸ºç®€ä½“ï¼‰
- `zh-TW`: ç¹ä½“ä¸­æ–‡ï¼ˆè‡ªåŠ¨è½¬æ¢ä¸ºç¹ä½“ï¼‰
- `zh`: ç®€ä½“ä¸­æ–‡ï¼ˆé»˜è®¤ï¼‰
- `en`: è‹±è¯­
- `ja`: æ—¥è¯­
- `ko`: éŸ©è¯­

### å¿«é€Ÿè¯­è¨€é…ç½®
```bash
# æ–¹æ³•1: ç¯å¢ƒå˜é‡ï¼ˆä¸´æ—¶ï¼‰
export WHISPER_LANGUAGE="zh-CN"
./bili-cortex.sh <url>

# æ–¹æ³•2: é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰
cp config_example.yaml config.yaml
# ç¼–è¾‘ config.yaml ä¸­çš„ language è®¾ç½®
```

### é…ç½®æ–‡ä»¶ç¤ºä¾‹
```yaml
transcription:
  model: 'large-v3'
  language: 'zh-CN'    # ç®€ä½“ä¸­æ–‡
  device: 'auto'
  compute_type: 'float16'
```

### è‡ªåŠ¨è½¬æ¢ç‰¹æ€§
- âœ… ç³»ç»Ÿä¼šæ ¹æ®è¯­è¨€è®¾ç½®è‡ªåŠ¨è¿›è¡Œç¹ç®€è½¬æ¢
- âœ… æ— éœ€æ‰‹åŠ¨åå¤„ç†ï¼Œè½¬å½•ç»“æœå·²ç»æ˜¯ç›®æ ‡æ ¼å¼
- âœ… æ”¯æŒæ··åˆå†…å®¹çš„æ™ºèƒ½è¯†åˆ«å’Œè½¬æ¢

## ğŸ“„ è¾“å‡ºæ–‡ä»¶

### è½¬å½•æ–‡ä»¶
è½¬å½•ç»“æœä¿å­˜åœ¨ `data/transcripts/` ç›®å½•ä¸‹ï¼š

```
data/transcripts/transcript_20250901_143022_a1b2c3d4.md
```

æ–‡ä»¶åŒ…å«ï¼š
- ğŸ“ å®Œæ•´è½¬å½•æ–‡æœ¬
- â° å¸¦æ—¶é—´æˆ³çš„åˆ†æ®µå†…å®¹  
- â„¹ï¸ å¤„ç†æ—¶é—´å’Œæ¥æºä¿¡æ¯

### çŸ¥è¯†åº“æ–‡ä»¶
å‘é‡åŒ–çŸ¥è¯†åº“ä¿å­˜åœ¨ `data/knowledge_base/` ç›®å½•ä¸‹ï¼š
- ğŸ§  æ–‡æœ¬å‘é‡æ•°æ®åº“
- ğŸ” æ”¯æŒè¯­ä¹‰æœç´¢
- ğŸ“Š è‡ªåŠ¨ç´¢å¼•å’Œæ£€ç´¢

## ğŸŒ æ”¯æŒå¹³å°

### Bilibili æ”¯æŒ
- âœ… **bilibili.com** - æ ‡å‡†æ¡Œé¢ç‰ˆ
- âœ… **www.bilibili.com** - WWWå­åŸŸå  
- âœ… **b23.tv** - çŸ­é“¾æ¥æ ¼å¼
- âœ… **m.bilibili.com** - ç§»åŠ¨ç‰ˆé“¾æ¥

### YouTube æ”¯æŒ
- âœ… **youtube.com** - æ ‡å‡†æ¡Œé¢ç‰ˆ
- âœ… **www.youtube.com** - WWWå­åŸŸå
- âœ… **youtu.be** - çŸ­é“¾æ¥æ ¼å¼
- âœ… **m.youtube.com** - ç§»åŠ¨ç‰ˆé“¾æ¥
- âœ… **é¢‘é“æ‰¹é‡å¤„ç†** - `/channel/`, `/c/`, `/@`, `/user/` æ ¼å¼

## ğŸ’» ç³»ç»Ÿè¦æ±‚

### åŸºç¡€è¦æ±‚
- **Python 3.8+**
- **4GB+ å¯ç”¨å†…å­˜** (æ¨è8GB+)
- **ç¨³å®šç½‘ç»œè¿æ¥**
- **5GB+ ç£ç›˜ç©ºé—´** (æ¨¡å‹å’Œæ•°æ®å­˜å‚¨)

### GPU åŠ é€Ÿï¼ˆå¯é€‰ï¼‰
- **NVIDIA GPU** æ”¯æŒ CUDA 11.8+
- **6GB+ æ˜¾å­˜** (æ¨è)
- è‡ªåŠ¨æ£€æµ‹GPUå¹¶å¯ç”¨åŠ é€Ÿ

## âš™ï¸ é«˜çº§ä½¿ç”¨

### æ‰‹åŠ¨è¿è¡Œ
å¦‚æœä¸ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼š

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# è¿è¡Œç¨‹åº
PYTHONPATH="$(pwd)" python src/main.py <é€‰é¡¹>
```

### é…ç½®è‡ªå®šä¹‰
```bash
# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
cp config_example.yaml my_config.yaml
# ç¼–è¾‘é…ç½®åè¿è¡Œ
PYTHONPATH="$(pwd)" python src/main.py --config my_config.yaml <url>
```

### æ€§èƒ½ä¼˜åŒ–
```bash
# ä½¿ç”¨æ›´å¤§çš„æ¨¡å‹ä»¥è·å¾—æ›´é«˜ç²¾åº¦
export WHISPER_MODEL="large-v3"

# è°ƒæ•´æ–‡æœ¬å—å¤§å°ä»¥ä¼˜åŒ–æœç´¢æ•ˆæœ  
export CHUNK_SIZE=1500

# ä½¿ç”¨æ›´å¼ºçš„åµŒå…¥æ¨¡å‹
export EMBEDDING_MODEL="BAAI/bge-large-zh-v1.5"
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**ç¯å¢ƒé—®é¢˜**ï¼š
```bash
# é‡æ–°è®¾ç½®ç¯å¢ƒ
rm -rf .venv
./setup.sh
```

**æƒé™é—®é¢˜**ï¼š
```bash
chmod +x setup.sh bili-cortex.sh
```

**ä¾èµ–é—®é¢˜**ï¼š
```bash
source .venv/bin/activate
pip install -r requirements.txt
```

**GPUé—®é¢˜**ï¼š
```bash
# æ£€æŸ¥CUDAæ˜¯å¦å¯ç”¨
python -c "import torch; print(torch.cuda.is_available())"

# å¼ºåˆ¶ä½¿ç”¨CPU
export WHISPER_DEVICE="cpu"
```

**çŸ¥è¯†åº“é—®é¢˜**ï¼š
```bash
# æ¸…ç†çŸ¥è¯†åº“é‡æ–°æ„å»º
rm -rf ./data/knowledge_base
./bili-cortex.sh <url>  # é‡æ–°å¤„ç†
```

**æµ‹è¯•å®‰è£…**ï¼š
```bash
./bili-cortex.sh --info
```

## âš ï¸ æ³¨æ„äº‹é¡¹

- ğŸ“¥ **é¦–æ¬¡è¿è¡Œ**ä¼šä¸‹è½½ Whisper æ¨¡å‹ï¼ˆçº¦ 3GBï¼‰å’ŒåµŒå…¥æ¨¡å‹ï¼ˆçº¦ 1.5GBï¼‰
- ğŸš€ **GPU æ”¯æŒ**ä¼šè‡ªåŠ¨æ£€æµ‹ï¼ŒCPU æ¨¡å¼ä½œä¸ºåå¤‡
- ğŸ¯ **è½¬å½•å‡†ç¡®ç‡**é€šå¸¸è¾¾åˆ° 90-95%
- ğŸ‡¨ğŸ‡³ **ä¸­æ–‡ä¼˜åŒ–**é’ˆå¯¹ä¸­æ–‡è¯­éŸ³è¿›è¡Œäº†ç‰¹åˆ«ä¼˜åŒ–
- ğŸ’¾ **å­˜å‚¨ç©ºé—´**æ¯å°æ—¶è§†é¢‘çº¦éœ€è¦ 100-200MB å­˜å‚¨ç©ºé—´
- ğŸ” **æœç´¢æ•ˆæœ**éšç€å¤„ç†è§†é¢‘æ•°é‡å¢åŠ è€Œæå‡

## ğŸ‰ åŠŸèƒ½æ¼”ç¤º

```bash
# 1. å¤„ç†è§†é¢‘å¹¶æ„å»ºçŸ¥è¯†åº“
./bili-cortex.sh https://www.bilibili.com/video/BV1234567890

# 2. æœç´¢ç›¸å…³å†…å®¹
./bili-cortex.sh --search "æœºå™¨å­¦ä¹ "

# 3. æ‰¹é‡å¤„ç†å¤šä¸ªè§†é¢‘
./bili-cortex.sh url1 url2 url3
```

## ğŸ—ï¸ æ¶æ„ç‰¹æ€§

### ç®€åŒ–è®¾è®¡åŸåˆ™
- **KISS**: ä¿æŒç®€å•ç›´è§‚çš„æ¥å£è®¾è®¡
- **DRY**: é¿å…é‡å¤ä»£ç ï¼Œç»Ÿä¸€æ ¸å¿ƒåŠŸèƒ½  
- **YAGNI**: åªå®ç°å¿…è¦åŠŸèƒ½ï¼Œé¿å…è¿‡åº¦å·¥ç¨‹åŒ–

### æŠ€æœ¯æ ˆ
- **è¯­éŸ³è¯†åˆ«**: Faster-Whisper (OpenAI Whisper ä¼˜åŒ–ç‰ˆ)
- **æ–‡æœ¬å¤„ç†**: LangChain + è‡ªå®šä¹‰ä¸­æ–‡ä¼˜åŒ–
- **å‘é‡åŒ–**: BGE-Large-ZH (ä¸­æ–‡è¯­ä¹‰ç†è§£)
- **å‘é‡å­˜å‚¨**: ChromaDB (è½»é‡çº§å‘é‡æ•°æ®åº“)
- **å¼‚æ­¥å¤„ç†**: asyncio + å¹¶å‘ä¼˜åŒ–

### æ€§èƒ½ç‰¹æ€§  
- âš¡ GPU è‡ªåŠ¨æ£€æµ‹å’ŒåŠ é€Ÿ
- ğŸ”„ æ™ºèƒ½æ‰¹å¤„ç†å’Œç¼“å­˜
- ğŸ“ˆ å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- ğŸ¯ ä¸­æ–‡è¯­ä¹‰æœç´¢ä¼˜åŒ–

---

ğŸš€ **ç«‹å³å¼€å§‹**: `./bili-cortex.sh <bilibili_url>`

ğŸ“Š **æŸ¥çœ‹æ¼”ç¤º**: `./bili-cortex.sh --search-demo`